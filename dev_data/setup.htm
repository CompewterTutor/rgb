<!DOCTYPE html>
<html>
 <head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="css/build.css?v07.06.2017">
  <!-- <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/style.css"> -->
  <script type="text/javascript" src="js/function.js?v07.06.2017"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings page</title>
  <script type="text/javascript">
   var set_real_time;
   function handleServerResponse(stage,jsonResponse){
    clearTimeout(set_real_time);
    var res = jsonResponse.time.split(":");
    real_time(hours=res[0],min=res[1],sec=res[2]);
    if (window.location.hash == '#wifi-connect') {
     html('title', ' ');
     toggle('dev-opt', 'show');
     toggle('dev-othe', 'show');
     toggle('wifi-connect1','hidden');
     toggle('first-restart', 'hidden');
    }
    if (window.location.hash == '#dev-update') {
     toggle('dev-update');
     toggle('dev-othe');
    }
    document.body.style.backgroundColor="#"+jsonResponse.color;
    if (stage != 'next') {

    }
   }


   function first_restart(submit,texts){
    var LangConnect2 = jsonResponse.LangConnect2;
    var LangRedirect = '<small class="pull-right">'+jsonResponse.LangRedirect+' 15 '+jsonResponse.LangSec+'<\/small>';
    if (searchModule(jsonResponse.module,'ntp') == 'yes') {set_time_zone(this);}
    if (confirm(texts)) {
     toggle('pop-up');
     var xmlHttp=createXmlHttpObject();
     xmlHttp.open("POST", "/restartWiFi", true);
     xmlHttp.send(null);
     xmlHttp.onload = function(e) {
      document.getElementById('url-ip').innerHTML = LangConnect2+' <h3><a href="http://'+xmlHttp.responseText+'">http://'+xmlHttp.responseText+'<\/a><\/h3>'+LangRedirect;
      setTimeout(function(){
       window.location.href = 'http://'+xmlHttp.responseText;
      }, 15000);
     }
    }
   }




   //function loadNews(news, repos){
   // htmls = '';
   // var xmlHttp=createXmlHttpObject();
   // xmlHttp.open('GET','https://api.github.com/repos/tretyakovsa/Sonoff_WiFi_switch/commits',true);
   // xmlHttp.send(null);
   // xmlHttp.onload = function(e) {
   //  var jsonBuild=JSON.parse(xmlHttp.responseText);
   //  var html = '';
   //  for(i = 0;i<10;i++) {
   //    html += '<li><a href="'+jsonBuild[i].html_url+'" target="_blank">'+jsonBuild[i].commit.message+'<\/a><\/li>';
   //  }
   //  document.getElementById(news).innerHTML = (html?html:'<li>No commitr<\/li>');
   // }
   //}

  </script>
  <style type="text/css">
   .wifi-0-60 {background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAn0lEQVQ4jc3QTQpBYRgF4McUmxBhLEtQlJ0YGCkptiMpc2ITyhoY+Rka3Bujr9CNe5k49Q6f09vh31LHGGvscUWEAzaYoJYEm1jhlvKWaATcR5wBh4vRgyouXxScUA5fdDN+EaP9usM4Q8EwacgcFinwLAmHFLF7g7fIvyuACs4J+IjSJxzS8TxqhFZaHDJ6KBhkxSFzTL/FUJBitJ9yB0PAZo1JMnGDAAAAAElFTkSuQmCC)}
   .wifi-60-70 {background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAyElEQVQ4jc3QPU4CURTF8Z+tHxALbbWAioQSNmAkjonRhMKlUNBgY+MapCf0JFrIRoxrGKhVCt5LJmScGaDxJCd5ybv/e08O/03HaKCLK9wgCe8umjjKA+vo4LaiO4EBl+FKVTg6wYUQqZf5eMAIE3xgjimecJ+Zu8ZhTHGOO4yR4vcPp3gNs2ebPQwLwE0P8oo8CJHL4Lc8OOoUXwXwJ2pFC6CNZQ68QKsMjnrETwb+Rr8qHPWSWfC8LRz1jtmuMOvCTvZZUKoVlb9FjouX7uMAAAAASUVORK5CYII=)}
   .wifi-70-80 {background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAvklEQVQ4jc3QPUoDYRjE8V+t8aOJrYGsRcB69wJicLNNLLyExzCk8RKSkDOkyFEC3kAhWPtR+C4sL+u6GxsHBp7mP88w/Df1kCDDFW6QhzvDBQ7rwBOkmLR0GhgwCF/awqVznAuVxnsEXOOgbHEWtShwjwfMwl1E3/vxDgluscQrPiO/YIEphnVDwqoGjP30EwyneG6AtzhqCoBLvNXAO4x+g0vd4aMCv/vep5MeKwHzrnCpDdb7wnCsxWh/0hf7eTrEN0FYwgAAAABJRU5ErkJggg==)}
   .wifi-80-90 {background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAt0lEQVQ4jc3QMUoDQRiG4UdMFZWtTKuQtbKQENhcIChZ6zRJIYg30cYm90nhJcxRTJ2kmYEhbMzupskHHwzDvO/8/JxbrpFjhDEmKMN5hAdcVYEZCrzWbBEYcB9+qQvHlrgTRnppIXhGN07RazhFidv9PeQNBP2qRcIwefSBL3ziPbkfHIKhgzessN3rL+a4/E8AT1hXCP7weAyOmWGTwBtM68Ixi0Tw3RSGC/xg2QaOyXBziuBodokKLg6opnwBAAAAAElFTkSuQmCC)}
   .wifi-90-100 {background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAkklEQVQ4jc3QMQrCQBhE4Q9ipYKNsVU0HkCFpNJKIq73v4+FWTASzUYbB37Y5s0Oj3/LFAUqnHFFaN4Vtph0gTOUuCVe2TBg1fySCscLWGomXb4oqDGOKxYDVwTkrx6KAQWbLpFwSIB372AY4fQBPiL7VMBDat0Bt6T1JdeWGjBPhWOepa6HwjF7PdL6kkmQ9lPu7WseJohUYa0AAAAASUVORK5CYII=)}
   .wifi-key {background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAmUlEQVQ4je3QvwqBYRgF8F8mVkZGuRq2b1AuQhnYldyMzaCU2ahcA8kNUL6B5VVvL58/M6fO8jznnOfp8EeMHrbIsccUlU/NA1yfcIXSO3MN52C4YI5DFDJBt4AN6ETiYQhtFnyUMoN2NBiFgNY3AVWcwiDHAsdINA7CDOvEXL/30C+4sExKnEW7B3SxCV/sQnnlRPMy4FdxA96PRYPg7eb3AAAAAElFTkSuQmCC)}
   .wifi {display:inline-block;width:16px;height:16px;background-size:16px;background-position:center center;background-repeat:no-repeat;vertical-align:middle;margin-right:3px;}
  </style>
 </head>
 <body onload="load('first');">
  <div class="container loader-bg">
   <div class="row hidden" id="content">
    <h1 id="title">{{LangSetting3}}</h1>
    <div class="col-sm-offset-1 col-sm-10 col-md-offset-2 col-md-8 col-lg-offset-3 col-lg-6">
     <h5 class="alert-danger" id="ssdp_t">{{SSDP}}</h5>

     <div class="btn-group" id="language">
      <a href="#" class="btn btn-default dropdown-toggle" onclick="toggle('language-set');loadLang('language-set');return false">{{lang}} <span class="caret"></span></a>
      <ul class="dropdown-menu hidden" id="language-set"><li><a href="#">{{LangLoading}}</a></li></ul>
     </div>

     <!-- DEVELOPER OPTIONS Module - START -->
     <div id="dev-opt">
      <a class="btn btn-block btn-danger" id="btn-devices" href="/">{{LangDevices}}</a>
      <!--       <a class="btn btn-block btn-default" href="#" onclick="loadNews('news')">ss</a>
<ul id="news"></ul> -->
      <hr id="hide-hr1">
      <div class="alert alert-dismissible alert-info {{g784673}}"><button class="close" onclick="hide('g784673',this);" type="button">×</button>
       <a href="/help.htm" target="_blank" class="close"><i class="help-img"></i></a>
       {{LangSetting4}}
       <span id="dev-update" class="hidden">
        <b>{{LangSetting5}}</b>
        <div class="btn-group">
         <a href="#" class="btn btn-default dropdown-toggle" onclick="toggle('repos-build');return false">Build <span class="caret"></span></a>
         <ul class="dropdown-menu hidden" id="repos-build">
          <li><a href="#" onclick="toggle('sonoff-build');loadBuild('sonoff','build');return false"><b>Sonoff</b> (Relay) <span class="caret"></span></a>
           <ul class="hidden" id="sonoff-build" style="margin-right:20px"><li><a href="#">{{LangLoading}}</a></li></ul>
          </li>
          <li><a href="#" onclick="toggle('rgb-build');return false"><b>RGB</b> (WS2811/WS2812/NeoPixel LEDs) <span class="caret"></span></a>
           <ul class="hidden" id="rgb-build" style="margin-right:20px"><li><a href="#">Soon...</a></li></ul>
          </li>
         </ul>
        </div>
        <div class="btn-group">
         <a href="#" class="btn btn-default dropdown-toggle" onclick="toggle('repos-spiffs');return false">Spiffs <span class="caret"></span></a>
         <ul class="dropdown-menu hidden" id="repos-spiffs">
          <li><a href="#" onclick="toggle('sonoff-spiffs');loadBuild('sonoff','spiffs');return false"><b>Sonoff</b> (Relay) <span class="caret"></span></a>
           <ul class="hidden" id="sonoff-spiffs" style="margin-right:20px"><li><a href="#">{{LangLoading}}</a></li></ul>
          </li>
          <li><a href="#" onclick="toggle('rgb-spiffs');return false"><b>RGB</b> (WS2811/WS2812/NeoPixel LEDs) <span class="caret"></span></a>
           <ul class="hidden" id="rgb-spiffs" style="margin-right:20px"><li><a href="#">Soon...</a></li></ul>
          </li>
         </ul>
        </div>
        <br>
        <b><a href="#" onclick="toggle('repos-bin');return false">{{LangSetting6}}</a></b>
        <span id="repos-bin" class="hidden">
         <b>GitHub: <a href="https://github.com/renat2985/rgb/tree/master/build" target="_blank">RGB</a>, <a href="https://github.com/tretyakovsa/Sonoff_WiFi_switch/tree/master/build" target="_blank">Sonoff</a>, <a href="https://github.com/tretyakovsa/jaluzi/tree/master/build" target="_blank">Jalousie</a></b>
         <form method="POST" action="/update" enctype="multipart/form-data">
          <div class="btn-group">
           <input type="file" class="btn btn-primary btn-xs" name="update" style="height:33px" accept=".bin">
           <input type="submit" class="btn btn-default btn-sm" value="Download" onclick="this.value='{{LangLoading}}';" style="height:33px">
          </div>
         </form>
        </span>
       </span>
      </div>
     </div>
     <!-- DEVELOPER OPTIONS Module - END -->

     <!-- SPACE AND NAME Module - START -->
     <h2>{{LangDevice}}</h2>
     <div class="input-group" style="width:100%">
      <input type="search" value="{{space}}" style="width:50%;display:inline" onclick="loadSpace('space-list')" id="space" class="form-control" pattern="[0-9a-zA-Zа-яА-Я.\- ]{1,20}"  placeholder="{{LangSpace}}" list="space-list">
      <datalist id="space-list" style="display:hidden;"></datalist>
      <input id="ssdp" value="{{SSDP}}" style="width:50%;display:inline" class="form-control" pattern="[0-9a-zA-Zа-яА-Я.\- ]{1,20}" placeholder="{{LangDevice}}">
     </div>
     <input class="btn btn-block btn-success" value="{{LangSave}}" onclick="send_request(this,'/device?ssdp='+val('ssdp')+'&space='+val('space'));html('ssdp_t',val('ssdp'));" type="button">
     <!-- SPACE AND NAME Module - END -->

     <hr id="wifi-connect">
     <div class="row hidden" id="pop-up">
      <div class="col-sm-offset-2 col-sm-8 pop-up">
       <h5 class="alert-warning">{{LangSearch1}}</h5>
       <div class="alert alert-dismissible alert-info" id="url-ip">
        <div class="loader"></div> {{LangConnect1}}
       </div>
      </div>
     </div>

     <!-- WIFI Module - START -->
     <div class="alert alert-dismissible alert-danger hidden" id="wifi-connect1">{{LangWiFi3}}</div>
     <h2>{{LangWiFi2}}</h2>
     <div class="btn-group btn-block" id="ssid-group">
      <a href="#" class="btn btn-default btn-block dropdown-toggle" onclick="toggle('ssid-select');loadWifi('ssid-select','ssid');return false"><span id="ssid-name">{{ssid}}</span> <span class="caret"></span></a>
      <ul class="dropdown-menu hidden" id="ssid-select"><li><a href="#">{{LangLoading}}</a></li></ul>
     </div>
     <input id="ssid" value="{{ssid}}" class="form-control hidden" pattern=".{1,20}" placeholder="{{LangWiFi1}}">
     <input id="ssidPass" value="{{ssidPass}}" pattern=".{8,20}" onfocus="this.type='text'" type="password" class="form-control" placeholder="{{LangPass}}">
     <label><input type="checkbox" id="checkboxIP" value="{{checkboxIP}}" onchange="val('checkboxIP',(this.checked?'1':'0'));toggle('static-ip');"> Задать статический IP</label>
     <div class="row hidden" id="static-ip">
      <div class="col-sm-6">
       <input id="ip" value="{{ip}}" class="form-control" pattern="[0-9.]{1,15}" placeholder="IP Adress">
       <input id="subnet" value="{{subnet}}" class="form-control" pattern="[0-9.]{1,15}" placeholder="Subnet Mask">
      </div>
      <div class="col-sm-6">
       <input id="getway" value="{{getway}}" class="form-control" pattern="[0-9.]{1,15}" placeholder="Default Getway">
       <input id="dns" value="{{dns}}" class="form-control" pattern="[0-9.]{1,15}" placeholder="DNS Server (Optional)">
      </div>
     </div>
     <input class="btn btn-block btn-success" value="{{LangSave}}" onclick="send_request(this,'/ssid?ssid='+val('ssid')+'&ssidPass='+encodeURIComponent(val('ssidPass'))+'&subnet='+val('subnet')+'&getway='+val('getway')+'&dns='+val('dns')+'&ip='+val('ip')+'&checkboxIP='+val('checkboxIP'));alert('{{LangReset2}}');" type="button">
     <!-- WIFI Module - END -->

     <hr>
     <div id="dev-othe">

      <!-- NTP Module - START -->
      <div class="module-ntp hidden">
       <h2>{{LangGMT1}}</h2>
       <input id="timeZone" value="{{timeZone}}" pattern="[0-9]{1,3}" class="form-control">
       <input class="btn btn-block btn-success" value="{{LangSave}}" onclick="send_request(this,'/timeZone?timeZone='+val('timeZone'));" type="button">
       <input class="btn btn-block btn-primary" value="{{LangGMT2}}" onclick="set_time_zone(this);" type="button">
       <h2>{{LangTime1}} <strong id="time">{{time}}</strong></h2>
       <input class="btn btn-block btn-primary" value="{{LangTime2}}" onclick="send_request(this,'/Time');" type="button">
       <hr>
      </div>
      <!-- NTP Module - END -->

      <!-- AP Module - START -->
      <h2>{{LangAP}}</h2>
      <div class="row">
       <div class="col-sm-6">
        <input id="ssidap" value="{{ssidAP}}" class="form-control" pattern=".{1,20}" placeholder="{{LangWiFi1}}">
        <input id="ssidApPass" value="{{ssidApPass}}" pattern=".{8,20}" onfocus="this.type='text'" type="password" class="form-control" placeholder="{{LangPass}}">
        <input class="btn btn-block btn-success" value="{{LangSave}}" onclick="send_request(this,'/ssidap?ssidAP='+val('ssidap')+'&ssidApPass='+encodeURIComponent(val('ssidApPass')));alert('{{LangReset2}}');" type="button">
       </div>
       <div class="col-sm-6">
        <div class="alert alert-dismissible alert-warning">{{LangWiFi4}}</div>
       </div>
      </div>
      <!-- AP Module - END -->

      <!-- DDNS Module - START -->
      <div class="module-ddns hidden">
       <hr>
       <h2>{{LangDdns1}}</h2>
       <div class="alert alert-dismissible alert-info {{g63563}}"><button class="close" onclick="hide('g63563',this);" type="button">×</button>{{LangDdns2}}</div>
       <div class="input-group" style="width:100%">
        <span class="input-group-addon">http://</span><input id="ddns-name" value="{{ddnsName}}" class="form-control" style="width:70%;display:inline" placeholder="Host name">
        <input id="ddns-port" value="{{ddnsPort}}" class="form-control" style="width:30%;display:inline" pattern="[0-9]{1,5}" placeholder="Host port">
       </div>
       <input id="ddns-server" value="{{ddns}}" class="form-control" pattern="http://.+" placeholder="Service URL">
       <input class="btn btn-block btn-success" value="{{LangSave}}" onclick="send_request(this,'/ddns?ddns='+encodeURIComponent(val('ddns-server'))+'&ddnsName='+val('ddns-name')+'&ddnsPort='+val('ddns-port'));alert('{{LangReset2}}');" type="button">
      </div>
      <!-- DDNS Module - END -->

      <!-- MQTT Module - START -->
      <div class="module-mqtt hidden">
       <hr>
       <h2>MQTT</h2>
       <div class="input-group" style="width:100%">
        <span class="input-group-addon">tcp://</span><input id="mqtt-server" value="{{mqttServer}}" class="form-control" style="width:70%;display:inline" pattern="[0-9a-zA-Z.\-]{1,20}" placeholder="MQTT Server, example: cloudmqtt.com">
        <input id="mqtt-port" value="{{mqttPort}}" class="form-control" style="width:30%;display:inline" pattern="[0-9]{1,5}" placeholder="MQTT Port">
       </div>
       <div class="input-group" style="width:100%">
        <input id="mqtt-user" value="{{mqttUser}}" class="form-control" style="width:50%;display:inline" placeholder="User Name">
        <input id="mqtt-pass" value="{{mqttPass}}" style="width:50%;display:inline"  onfocus="this.type='text'" type="password" class="form-control" placeholder="Pass">
       </div>
       <input class="btn btn-block btn-success" value="{{LangSave}}" onclick="send_request(this,'/mqtt?server='+encodeURIComponent(val('mqtt-server'))+'&port='+val('mqtt-port')+'&user='+val('mqtt-user')+'&pass='+val('mqtt-pass'));" type="button">
      </div>
      <!-- MQTT Module - END -->

      <hr>
      <input class="btn btn-block btn-default" value="{{LangCookie}}" onclick="delAllCookies();location.reload();" type="button">
      <input class="btn btn-block btn-warning" value="{{LangReset1}}" onclick="if(confirm('{{LangReset3}}')){send_request(this,'/restart?device=ok');}" type="button">

     </div>

     <input class="btn btn-block btn-warning hidden" id="first-restart" value="{{LangReset1}}" onclick="first_restart(this,'{{LangReset3}}');" type="button">

    </div>
   </div>
  </div>
 </body>
</html>
