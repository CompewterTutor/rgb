<!DOCTYPE html>
<html>
 <head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <script src="js/build.chart.js?v07.06.2017" charset="utf-8"></script>
  <!-- <link rel="stylesheet" type="text/css" href="css/chartist.min.css">
<script src="js/chartist.min.js" charset="utf-8"></script>
<script type="text/javascript" src="js/chart.js"></script> -->
  <link rel="stylesheet" type="text/css" href="css/build.css?v07.06.2017">
  <!-- <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/style.css"> -->
  <script type="text/javascript" src="js/function.js?v07.06.2017"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Options page</title>
  <script type="text/javascript">
   var mode = 'off';
   var nex_color = 'ff6600';

   function handleServerResponse(stage,jsonResponse){
    if (stage != 'next') {
     var img = _('.thumb img'),
         canvas = _('#cs'),
         result = _('.result'),
         preview = _('.preview'),x = '',y = '';
     // click function
     img.addEventListener('click', function(e){
      // chrome
      if(e.offsetX) {x=e.offsetX;y=e.offsetY;}
      // firefox
      else if(e.layerX) {x=e.layerX;y=e.layerY;}
      useCanvas(canvas,img,function(){
       // get image data
       var p = canvas.getContext('2d').getImageData(x, y, 1, 1).data;
       nex_color = rgbToHex(p[0],p[1],p[2]);
       on_rgb(this,0);
       toggle('pop-up','hidden');
       //on_rgb(this,p[0],p[1],p[2]);
      });
     },false);
     // preview function mousemove
     img.addEventListener('mousemove', function(e){
      // chrome
      if(e.offsetX) {x=e.offsetX;y=e.offsetY;}
      // firefox
      else if(e.layerX) {x=e.layerX;y=e.layerY;}
      useCanvas(canvas,img,function(){
       var p = canvas.getContext('2d').getImageData(x, y, 1, 1).data;
       preview.style.background = "#"+rgbToHex(p[0],p[1],p[2]);
      });
     },false);
     document.body.style.backgroundColor="#"+jsonResponse.color;
     val('off-on',(jsonResponse.state=='0'?jsonResponse.LangOn:jsonResponse.LangOff));
     if (stage != 'next') {
      //if (!jsonResponse.g72895) loadChart('ct-chart','sensor.json');
      if (!jsonResponse.g85723 && searchModule(jsonResponse.module,"analog") == 'yes') loadChart('ct-analog','analog.json');
     }
     if (!jsonResponse.g42843) loadTimer("timer-list","rgb");
    }
   }
   function useCanvas(el,image,callback){
    el.width = image.width;
    el.height = image.height;
    el.getContext('2d').drawImage(image, 0, 0, image.width, image.height);
    return callback();
   }
   function _(el){
    return document.querySelector(el);
   };
   function componentToHex(c) {
    var hex = c.toString(16);
    return hex.length == 1 ? "0" + hex : hex;
   }
   function rgbToHex(r, g, b) {
    return componentToHex(r) + componentToHex(g) + componentToHex(b);
   }
   function findPos(obj) {
    var curleft = 0, curtop = 0;
    if (obj.offsetParent) {
     do {
      curleft += obj.offsetLeft;
      curtop += obj.offsetTop;
     } while (obj = obj.offsetParent);
     return { x: curleft, y: curtop };
    }
    return undefined;
   }

   function set_rgb(submit,t){
    document.body.style.background="#"+nex_color;
    //server = "/rgb?r="+r+"&g="+g+"&b="+b+"&t="+t+"&s="+val('sound')*10;
    if (mode == 'off') {
     server = "/set?c="+nex_color+"&time="+t+"&sound="+val('sound')*10+"&s="+val('speed')+"&b="+val('brightness');
    } else {
     server = "/set?m="+mode+"&time="+t+"&sound="+val('sound')*10+"&s="+val('speed')+"&b="+val('brightness');
    }
    document.getElementById('url1').innerHTML='<a href="http://'+document.domain+server+'" target="_blank">http://'+document.domain+server+'<\/a>';
    if(navigator.onLine) {
     var xhttp=createXmlHttpObject();
     xhttp.open("GET", "https://api.ipify.org?format=text", true);
     xhttp.send(null);
     xhttp.onload = function(e) {
      if (xhttp.readyState === xhttp.DONE) {
       if (xhttp.status === 200) {
        document.getElementById('url2').innerHTML='<a href="http://'+(jsonResponse.ddnsName?(jsonResponse.ddnsName+':'+jsonResponse.ddnsPort+server):xhttp.responseText+':'+jsonResponse.ddnsPort+server)+'" target="_blank">http://'+(jsonResponse.ddnsName?(jsonResponse.ddnsName+':'+jsonResponse.ddnsPort+server):xhttp.responseText+':'+jsonResponse.ddnsPort+server)+'<\/a>';
       }
      }
     }
    }
    send_request(submit,server);
    mode = 'off';
   }
   function on_rgb(submit,t){
    set_rgb(submit,t,'off');
   }
  </script>
 </head>
 <body onload="load('first');">
  <div class="container loader-bg">
   <div class="row hidden" id="content">
    <h1 id="title">{{LangOptions1}}</h1>
    <div class="col-sm-offset-1 col-sm-10 col-md-offset-2 col-md-8 col-lg-offset-3 col-lg-6">
     <h5 class="alert-info">{{SSDP}}</h5>
     <div class="btn-group" id="language">
      <a href="#" class="btn btn-default dropdown-toggle" onclick="toggle('language-set');loadLang('language-set');return false">{{lang}} <span class="caret"></span></a>
      <ul class="dropdown-menu hidden" id="language-set"><li><a href="#">{{LangLoading}}</a></li></ul>
     </div>
     <a class="btn btn-block btn-danger" id="btn-devices" href="/">{{LangDevices}}</a>
     <a class="btn btn-block btn-default" href="/page.htm?setup"><i class="opt-img"></i> {{LangSetting3}}</a>
     <hr>
     <div class="alert alert-dismissible alert-info {{g2342}}"><button class="close" onclick="hide('g2342',this);" type="button">×</button>{{LangIfttt1}}<span id="hide" class="hidden">{{LangIfttt2}}</span></div>

     <!-- CHART POP-UP Module - START -->
     <div class="row hidden" id="pop-up">
      <div class="col-sm-offset-3 col-sm-6 pop-up">
       <h5 class="alert-warning">{{LangScenery1}}</h5>
       <h4>{{LangTime8}}</h4>
       <div class="btn-group">
        <input type="button" class="btn btn-primary btn-sm" onclick="on_rgb(this,60);toggle('pop-up')" value="1">
        <input type="button" class="btn btn-primary btn-sm" onclick="on_rgb(this,300);toggle('pop-up')" value="5">
        <input type="button" class="btn btn-primary btn-sm" onclick="on_rgb(this,600);toggle('pop-up')" value="10">
        <input type="button" class="btn btn-primary btn-sm" onclick="on_rgb(this,1500);toggle('pop-up')" value="15">
        <input type="button" class="btn btn-primary btn-sm" onclick="on_rgb(this,1800);toggle('pop-up')" value="30">
        <input type="button" class="btn btn-primary btn-sm" onclick="on_rgb(this,3600);toggle('pop-up')" value="60">
       </div>
       <br>
       <div class="btn-group">
        <input type="button" class="btn btn-primary btn-sm" onclick="on_rgb(this,5400);toggle('pop-up')" value="1:30">
        <input type="button" class="btn btn-primary btn-sm" onclick="on_rgb(this,7200);toggle('pop-up')" value="2:00">
        <input type="button" class="btn btn-primary btn-sm" onclick="on_rgb(this,10800);toggle('pop-up')" value="3:00">
        <input type="button" class="btn btn-primary btn-sm" onclick="on_rgb(this,0);toggle('pop-up')" value="&#8734;">
       </div>
       <hr>
       <h4>{{LangTime5}}</h4>
       <div class="input-group">
        <input class="form-control" value="0.1" pattern="[-+]?[0-9]*[.]?[0-9]+" id="sound">
        <span class="input-group-addon">{{LangSec}}</span>
       </div>
       <h4>{{LangSpeed}}</h4>
       <input id="speed" class="form-control" onchange="on_rgb(this,0);" type="range" min="0" max="255" step="1" value="100">
       <h4>{{LengBrightness}}</h4>
       <input id="brightness" class="form-control" onchange="on_rgb(this,0);" type="range" min="0" max="255" step="1" value="255">
       <hr>
       <input class="btn btn-block btn-default" value="{{LangClose}}" onclick="toggle('pop-up');" type="button">
      </div>
     </div>
     <!-- CHART POP-UP Module - END -->

     <!-- CHART COLOR IMAGE Module - START -->
     <div class="thumb">
      <div class="preview"></div>
      <img alt="" style="cursor:pointer;width:100%" src="/img/swatches.png" />
     </div>
     <canvas id="cs" style="display:none"></canvas>
     <!-- CHART COLOR IMAGE Module - END -->

     <select class="btn btn-block btn-default" onchange="toggle('pop-up');mode=this.value;on_rgb(this,0);">
      <option value="0">Select Mode</option>
      <option value="0">Static</option>
      <option value="1">Blink</option>
      <option value="2">Breath</option>
      <option value="3">Color Wipe</option>
      <option value="4">Color Wipe Random</option>
      <option value="5">Random Color</option>
      <option value="6">Single Dynamic</option>
      <option value="7">Multi Dynamic</option>
      <option value="8">Rainbow</option>
      <option value="9">Rainbow Cycle</option>
      <option value="10">Scan</option>
      <option value="11">Dual Scan</option>
      <option value="12">Fade</option>
      <option value="13">Theater Chase</option>
      <option value="14">Theater Chase Rainbow</option>
      <option value="15">Running Lights</option>
      <option value="16">Twinkle</option>
      <option value="17">Twinkle Random</option>
      <option value="18">Twinkle Fade</option>
      <option value="19">Twinkle Fade Random</option>
      <option value="20">Sparkle</option>
      <option value="21">Flash Sparkle</option>
      <option value="22">Hyper Sparkle</option>
      <option value="23">Strobe</option>
      <option value="24">Strobe Rainbow</option>
      <option value="25">Multi Strobe</option>
      <option value="26">Blink Rainbow</option>
      <option value="27">Chase White</option>
      <option value="28">Chase Color</option>
      <option value="29">Chase Random</option>
      <option value="30">Chase Rainbow</option>
      <option value="31">Chase Flash</option>
      <option value="32">Chase Flash Random</option>
      <option value="33">Chase Rainbow White</option>
      <option value="34">Chase Blackout</option>
      <option value="35">Chase Blackout Rainbow</option>
      <option value="36">Color Sweep Random</option>
      <option value="37">Running Color</option>
      <option value="38">Running Red Blue</option>
      <option value="39">Running Random</option>
      <option value="40">Larson Scanner</option>
      <option value="41">Comet</option>
      <option value="42">Fireworks</option>
      <option value="43">Fireworks random</option>
      <option value="44">Merry Christmas</option>
     </select>
     <input type="button" class="btn btn-block btn-lg btn-primary" onclick="send_request(this,'/rgb');" id="off-on" value="{{LangOnOff}}">
     <hr>

     <!-- TIMERS Module - START -->
     <h2>{{LangTimer}}</h2>
     <div class="alert alert-dismissible alert-warning {{g42843}}">
      <button class="close" onclick="hide('g42843',this);" type="button">×</button>
      <ul id="timer-list"><li>{{LangLoading}}</li></ul>
     </div>
     <a class="btn btn-block btn-default" href="/timer.htm">{{LangTime3}}</a>
     <hr>
     <!-- TIMERS Module - END -->

     <!--       <div class="{{g74392}}">
<button class="close" onclick="hide('g74392',this);" type="button">×</button>
<h2>Led Count</h2>
<div class="row">
<div class="col-sm-4">
<input id="led-count" value="{{ledCount}}" class="form-control" pattern="[0-9]*[.,]?[0-9]+">
<input class="btn btn-block btn-success" value="{{LangSave}}" onclick="send_request(this,'/ledCount?num='+val('led-count'));alert('{{LangReset2}}');" type="button">
</div>
<div class="col-sm-8">
<div class="alert alert-dismissible alert-info">Количество led огней.</div>
</div>
</div>
<hr>
</div> -->

     <!-- CHART ANALOG Module - START -->
     <div class="module-analog hidden {{g85723}}">
      <button class="close" onclick="hide('g85723',this);" type="button">×</button>
      <a href="/page.htm?chart&analog" target="_blank" class="close"><i class="popup-img"></i></a>
      <div id="ct-analog" style="height:200px;margin-left:-20px"></div>
      <hr>
     </div>
     <!-- CHART ANALOG Module - END -->

     <!-- MOVEMENT Module - START -->
     <div class="module-movement hidden {{g8359}}">
      <button class="close" onclick="hide('g8359',this);" type="button">×</button>
      <h2>{{LangPir1}}</h2>
      <div class="row">
       <div class="col-sm-8">
        <div class="alert alert-dismissible alert-info">{{LangPir2}}</div>
       </div>
       <div class="col-sm-4">
        <div class="input-group">
         <input id="pir-time" value="{{pirTime}}" class="form-control" pattern="[0-9]*[.,]?[0-9]+"><span class="input-group-addon">{{LangSec}}</span>
        </div>
        <div class="btn-group" style="width:100%">
         <input class="btn btn-success" style="width:60%" value="{{LangSave}}" onclick="send_request(this,'/pir?t='+val('pir-time'));" type="button">
         <input class="btn btn-default" style="width:40%" value="{{LangOff.}}" onclick="val('pir-time','0');send_request(this,'/pir?t=0');" type="button">
        </div>
       </div>
      </div>
      <hr>
     </div>
     <!-- MOVEMENT Module - END -->

     <a class="btn btn-block btn-default" href="/page.htm?setup"><i class="opt-img"></i> {{LangSetting3}}</a>
    </div>
   </div>
  </div>
 </body>
</html>
