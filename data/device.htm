<!DOCTYPE html>
<html lang="ru">
 <head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" href="/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="/style.css">
  <script type="text/javascript" src="/function.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Options page</title>
  <script type="text/javascript">
   var mode = 'off';
   var nex_color = 'ff6600'
   function handleServerResponse(){
    var img = _('.thumb img'),
        canvas = _('#cs'),
        result = _('.result'),
        preview = _('.preview'),x = '',y = '';
    // click function
    img.addEventListener('click', function(e){
     // chrome
     if(e.offsetX) {
      x = e.offsetX;
      y = e.offsetY;
     }
     // firefox
     else if(e.layerX) {
      x = e.layerX;
      y = e.layerY;
     }
     useCanvas(canvas,img,function(){
      // get image data
      var p = canvas.getContext('2d').getImageData(x, y, 1, 1).data;
      nex_color = rgbToHex(p[0],p[1],p[2]);
      toggle('pop-up');
      //on_rgb(this,p[0],p[1],p[2]);
     });
    },false);
    // preview function mousemove
    img.addEventListener('mousemove', function(e){
     // chrome
     if(e.offsetX) {
      x = e.offsetX;
      y = e.offsetY;
     }
     // firefox
     else if(e.layerX) {
      x = e.layerX;
      y = e.layerY;
     }
     useCanvas(canvas,img,function(){
      var p = canvas.getContext('2d').getImageData(x, y, 1, 1).data;
      preview.style.background = "#"+rgbToHex(p[0],p[1],p[2]);
     });
    },false);
    document.body.style.backgroundColor="#"+jsonResponse.color;
    if (jsonResponse.state=='0') {blockval=jsonResponse.LangOn;} else {blockval=jsonResponse.LangOff;}
    document.getElementById('off-on').value = blockval;
   }
   function useCanvas(el,image,callback){
    el.width = image.width;
    el.height = image.height;
    el.getContext('2d').drawImage(image, 0, 0, image.width, image.height);
    return callback();
   }
   function _(el){
    return document.querySelector(el);
   };
   function componentToHex(c) {
    var hex = c.toString(16);
    return hex.length == 1 ? "0" + hex : hex;
   }
   function rgbToHex(r, g, b) {
    return componentToHex(r) + componentToHex(g) + componentToHex(b);
   }
   function findPos(obj) {
    var curleft = 0, curtop = 0;
    if (obj.offsetParent) {
     do {
      curleft += obj.offsetLeft;
      curtop += obj.offsetTop;
     } while (obj = obj.offsetParent);
     return { x: curleft, y: curtop };
    }
    return undefined;
   }

   function led(submit){
    server = "/led";
    send_request(submit,server);
    load();
   }
   function set_rgb(submit,t){
    document.body.style.background="#"+nex_color;
    //server = "/rgb?r="+r+"&g="+g+"&b="+b+"&t="+t+"&s="+val('sound')*10;
    if (mode == 'off') {
     server = "/set?c="+nex_color+"&time="+t+"&sound="+val('sound')*10;
    } else {
     server = "/set?m="+mode+"&time="+t+"&sound="+val('sound')*10;
    }
    document.getElementById('url1').innerHTML='<a href="http://'+document.domain+server+'" target="_blank">http://'+document.domain+server+'</a>';
    if(navigator.onLine) {
     xhr = new XMLHttpRequest();
     xhr.open("GET","https://api.ipify.org?format=text",true);
     xhr.onload = function () {
      if (xhr.readyState === xhr.DONE) {
       if (xhr.status === 200) {
        document.getElementById('url2').innerHTML='<a href="http://'+(jsonResponse.DDNSName?(jsonResponse.DDNSName+':'+jsonResponse.DDNSPort+server):xhr.responseText+':'+jsonResponse.DDNSPort+server)+'" target="_blank">http://'+(jsonResponse.DDNSName?(jsonResponse.DDNSName+':'+jsonResponse.DDNSPort+server):xhr.responseText+':'+jsonResponse.DDNSPort+server)+'</a>';
       }
      }
     };
     xhr.send(null);
    }
    send_request(submit,server);
    load();
    mode = 'off';
   }
   function on_rgb(submit,t){
    toggle('pop-up');
    set_rgb(submit,t,'off');
   }
   function set_time(submit){
    server = "/TimeLed?t="+val('led');
    send_request(submit,server);
   }
   function set_time1(submit){
    server = "/times1?time1="+val('time1');
    send_request(submit,server);
   }
   function set_time2(submit){
    server = "/times2?time2="+val('time2');
    send_request(submit,server);
   }
   function set_mode(mod,submit){
    toggle('pop-up');
    mode = mod;
   }
  </script>
 </head>
 <body onload="load();">
  <div class="container">
   <div class="row" style="text-align:center;">
    <h1 style="margin:50px;">{{LangOptions1}}</h1>
    <div class="col-sm-offset-2 col-sm-8 col-md-offset-3 col-md-6">
     <h5 class="alert-info">{{SSDP}}</h5>
     <select class="btn btn-default" name="language" style="margin-top:-45px;float:right" onchange="language(this.value,this);">
      <option value="en">{{LangLanguage}}</option>
      <option value="ru">Русский</option>
      <option value="en">English</option>
      <option value="lv">Latviski</option>
     </select>
     <a class="btn btn-block btn-danger" href="/">{{LangDevices}}</a>
     <a class="btn btn-block btn-default" href="/setup.htm">{{LangSetting3}}</a>
     <hr>
     <div class="alert alert-dismissible alert-info">{{LangIfttt1}}<span id="hide" class="hidden">{{LangIfttt2}}</span>
     </div>
     <div class="col-sm-offset-3 col-sm-6 pop-up hidden" id="pop-up">
      <h5 class="alert-warning">{{LangTime10}}</h5>
      <h4>{{LangTime8}}</h4>
      <div class="btn-group">
       <input type="submit" class="btn btn-primary btn-sm" onclick="on_rgb(this,60)" value="1">
       <input type="submit" class="btn btn-primary btn-sm" onclick="on_rgb(this,300)" value="5">
       <input type="submit" class="btn btn-primary btn-sm" onclick="on_rgb(this,600)" value="10">
       <input type="submit" class="btn btn-primary btn-sm" onclick="on_rgb(this,1500)" value="15">
       <input type="submit" class="btn btn-primary btn-sm" onclick="on_rgb(this,1800)" value="30">
      </div>
      <br>
      <div class="btn-group">
       <input type="submit" class="btn btn-primary btn-sm" onclick="on_rgb(this,3600)" value="60">
       <input type="submit" class="btn btn-primary btn-sm" onclick="on_rgb(this,5400)" value="1:30">
       <input type="submit" class="btn btn-primary btn-sm" onclick="on_rgb(this,7200)" value="2:00">
       <input type="submit" class="btn btn-primary btn-sm" onclick="on_rgb(this,10800)" value="3:00">
      </div>
      <hr>
      <h4>{{LangTime5}}</h4>
      <div class="input-group">
       <input class="form-control" value="0.1" pattern="[-+]?[0-9]*[.]?[0-9]+" id="sound">
       <span class="input-group-addon">{{LangSec}}</span>
      </div>
      <hr>
      <a href="#" onclick="toggle('pop-up');return false" class="btn btn-block btn-default">{{LangCancel}}</a>
     </div>
     <div class="thumb">
      <div class="preview"></div>
      <img alt="" style="cursor:pointer;width:100%;" src="/swatches.png" />
     </div>
     <canvas id="cs" style="display:none;"></canvas>

     <select class="btn btn-block btn-default" onchange="set_mode(this.value,this);">
      <option value="0">Select Mode</option>
      <option value="0">Static</option>
      <option value="1">Blink</option>
      <option value="2">Breath</option>
      <option value="3">Color Wipe</option>
      <option value="4">Color Wipe Random</option>
      <option value="5">Random Color</option>
      <option value="6">Single Dynamic</option>
      <option value="7">Multi Dynamic</option>
      <option value="8">Rainbow</option>
      <option value="9">Rainbow Cycle</option>
      <option value="10">Scan</option>
      <option value="11">Dual Scan</option>
      <option value="12">Fade</option>
      <option value="13">Theater Chase</option>
      <option value="14">Theater Chase Rainbow</option>
      <option value="15">Running Lights</option>
      <option value="16">Twinkle</option>
      <option value="17">Twinkle Random</option>
      <option value="18">Twinkle Fade</option>
      <option value="19">Twinkle Fade Random</option>
      <option value="20">Sparkle</option>
      <option value="21">Flash Sparkle</option>
      <option value="22">Hyper Sparkle</option>
      <option value="23">Strobe</option>
      <option value="24">Strobe Rainbow</option>
      <option value="25">Multi Strobe</option>
      <option value="26">Blink Rainbow</option>
      <option value="27">Chase White</option>
      <option value="28">Chase Color</option>
      <option value="29">Chase Random</option>
      <option value="30">Chase Rainbow</option>
      <option value="31">Chase Flash</option>
      <option value="32">Chase Flash Random</option>
      <option value="33">Chase Rainbow White</option>
      <option value="34">Chase Blackout</option>
      <option value="35">Chase Blackout Rainbow</option>
      <option value="36">Color Sweep Random</option>
      <option value="37">Running Color</option>
      <option value="38">Running Red Blue</option>
      <option value="39">Running Random</option>
      <option value="40">Larson Scanner</option>
      <option value="41">Fireworks</option>
     </select>

     <input type="submit" class="btn btn-block btn-primary" onclick="led(this);" id="off-on" value="{{LangOnOff}}">

     <hr>
     <h2>{{LangTime3}}</h2>
     <div class="row">
      <div class="col-sm-6">
       <h4>{{LangTime4}} 1:</h4>
       <input id="time1" value="{{times1}}" pattern="(0[0-9]|1[0-9]|2[0-3])(:[0-5][0-9]){2}" class="form-control" placeholder="{{LangExample}}: 07:10:30">
       <div class="btn-group" style="width:100%;">
        <input class="btn btn-success" style="width:70%;" value="{{LangSave}}" onclick="set_time1(this);" type="submit">
        <input class="btn btn-default" style="width:30%;" value="{{LangOff.}}" onclick="document.getElementById('time1').value='';set_time1(this);" type="submit">
       </div>
       <h4>{{LangTime4}} 2:</h4>
       <input id="time2" value="{{times2}}" pattern="(0[0-9]|1[0-9]|2[0-3])(:[0-5][0-9]){2}" class="form-control" placeholder="{{LangExample}}: 07:10:30">
       <div class="btn-group" style="width:100%;">
        <input class="btn btn-success" style="width:70%;" value="{{LangSave}}" onclick="set_time2(this);" type="submit">
        <input class="btn btn-default" style="width:30%;" value="{{LangOff.}}" onclick="document.getElementById('time2').value='';set_time2(this);" type="submit">
       </div>
      </div>
      <div class="col-sm-6">
       <div class="alert alert-dismissible alert-warning">{{LangTime6}}</div>
       <div class="alert alert-dismissible alert-info">
        {{LangIfttt3}}
       </div>
      </div>
     </div>
     <div class="row">
      <h2>{{LangTime5}}</h2>
      <div class="col-sm-8">
       <div class="alert alert-dismissible alert-info">{{LangTime7}}</div>
      </div>
      <div class="col-sm-4">
       <div class="input-group">
        <input id="led" value="{{timeled}}" class="form-control" pattern="[0-9]*[.,]?[0-9]+">
        <span class="input-group-addon">{{LangSec}}</span>
       </div>
       <input class="btn btn-block btn-success" value="{{LangSave}}" onclick="set_time(this);" type="submit">
      </div>
     </div>
     <hr>
     <a class="btn btn-block btn-default" href="/setup.htm">{{LangSetting3}}</a>
    </div>
   </div>
  </div>
 </body>
</html>
